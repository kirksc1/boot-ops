plugins {
    id 'java'
    id 'jacoco'
}

group 'com.github.kirksc1.bootops'
version '0.0.1-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.0'

    testImplementation('org.springframework.boot:spring-boot-starter-test:2.7.0')
    testImplementation project(':boot-ops-cli')
    testImplementation project(':boot-ops-core')
    testImplementation project(':boot-ops-jackson')
}

test {
    useJUnitPlatform()
}

tasks.register("codeCoverageReport", JacocoReport) {
    reports {
        xml.enabled true
    }
    subprojects {
        subproject -> subproject.plugins.withType(JacocoPlugin).configureEach {
            subproject.tasks.matching({t -> t.extensions.findByType(JacocoTaskExtension) }).configureEach {
                testTask ->
                sourceSets subproject.sourceSets.main
                executionData(testTask)
            }

            subproject.tasks.matching({ t -> t.extensions.findByType(JacocoTaskExtension) }).forEach {
                rootProject.tasks.codeCoverageReport.dependsOn(it)
            }
        }
    }
}